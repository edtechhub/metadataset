{% extends 'publications/base.html' %}

{% load metadataset_tags %}

{% block title %}
  Experiment | Metadataset | www.metadataset.com
{% endblock %}

{% block css %}
  {% load staticfiles %}
{% endblock %}

{% block content %}

<h1>Intervention: {{ experiment.intervention|capfirst }}</h1>
<p><a href="{% url 'publication' subject=subject.slug publication_pk=publication.pk %}">Back to all interventions</a></p>
<p>If possible, please select a more specific intervention from this more detailed list.</p>

<form method="post" action="">{% csrf_token %}
  {{ experiment_form.intervention }}

  <table>
    <tr><th colspan="3">Populations</th></tr>
    <tr><td colspan="3">When you select and save a population, a link will appear for "Outcomes". Click that link to select outcomes for this population.</td></tr>
    <tr>
      <td colspan="2"></td>
      <td class="centered">Select</td>
    </tr>
    {{ experiment_population_formset.management_form }}
    {% for form in experiment_population_formset %}
      <tr>
        <td>
          {% for hidden_field in form.hidden_fields %}
            {{ hidden_field }}
          {% endfor %}
          {% if forloop.first %}
            {{ form.population.label }}:
          {% endif %}
        </td>
        <td>{{ form.population }}
          {% if form.instance.population %}
            <a href="{% url 'population' subject=subject.slug publication_pk=publication.pk experiment_index=experiment_index population_index=forloop.counter0 %}">Outcomes</a>
          {% endif %}
        </td>
        <td class="centered">{{ form.DELETE }}</td>
      </tr>
    {% endfor %}
    <tr>
      <td class="bottom"></td>
      <td class="button bottom"><input type="submit" name="save" value="Save all changes" /></td>
      <td class="button bottom centered"><input type="submit" name="delete" value="Delete selected" /></td>
    </tr>

    <tr><td class="empty" colspan="3">&nbsp;</td></tr>

    <tr><th colspan="3">Experimental design</th></tr>
    <tr><td class="top" colspan="3">We will assume that the same experimental design was used to test the effects of this intervention on all of the populations that you selected above. If different experimental designs were used, please create a separate intervention (on the <a href="{% url 'publication' subject=subject.slug publication_pk=publication.pk %}">previous page</a>) for each experimental design.</td></tr>
    <tr>
      <td colspan="2"></td>
      <td class="centered">Select</td>
    </tr>
    {{ experiment_design_formset.management_form }}
    {% for form in experiment_design_formset %}
    <tr>
      <td>
        {% for hidden_field in form.hidden_fields %}
          {{ hidden_field }}
        {% endfor %}
        {% if forloop.first %}
          {{ form.design.label }}:
        {% endif %}
      </td>
      <td>{{ form.design }}</td><td class="centered">{{ form.DELETE }}</td>
    </tr>
    {% endfor %}
    <tr>
      <td class="bottom"></td>
      <td class="button bottom"><input type="submit" name="save" value="Save all changes" /></td>
      <td class="button bottom centered"><input type="submit" name="delete" value="Delete selected" /></td>
    </tr>

    <tr><td class="empty" colspan="3">&nbsp;</td></tr>

    <tr><th colspan="3">Tags</th></tr>
    <tr>
      <td class="top" colspan="3">If you have already entered the following metadata for this publication (see <a href="{% url 'metadata' subject=subject.slug publication_pk=publication.pk %}">other metadata</a> ), then you do not have to enter it here. However, if there is metadata that applies to this intervention only, then you should enter it here.</td>
    </tr>
    <tr>
      <td colspan="2"></td>
      <td class="centered">Select</td>
    </tr>
    {{ experiment_country_formset.management_form }}
    {% for form in experiment_country_formset %}
      <tr>
        <td>
          {% for hidden_field in form.hidden_fields %}
            {{ hidden_field }}
          {% endfor %}
          {% if forloop.first %}
            {{ form.country.label }}:
          {% endif %}
        </td>
        <td>{{ form.country }}</td><td class="centered">{{ form.DELETE }}</td>
      </tr>
    {% endfor %}
    {{ experiment_lat_long_dms_formset.management_form }}
    {% for form in experiment_lat_long_dms_formset %}
    <tr>
      <td>
        {% for hidden_field in form.hidden_fields %}
          {{ hidden_field }}
        {% endfor %}
        {% if forloop.first %}
          Coordinates:
        {% endif %}
      </td>
      <td>Latitude (DMS): {{ form.latitude_degrees|add_class:"coordinates" }} &#176; {{ form.latitude_minutes|add_class:"coordinates" }} ' {{ form.latitude_seconds|add_class:"coordinates" }} " {{ form.latitude_direction }}</td>
      <td></td>
      <td class="centered">{{ form.DELETE }}</td>
    </tr>
    <tr>
      <td></td>
      <td>Longitude (DMS): {{ form.longitude_degrees|add_class:"coordinates" }} &#176; {{ form.longitude_minutes|add_class:"coordinates" }} ' {{ form.longitude_seconds|add_class:"coordinates" }} " {{ form.longitude_direction }}</td>
      <td></td>
      <td></td>
    </tr>
    {% endfor %}
    {{ experiment_lat_long_formset.management_form }}
    {% for form in experiment_lat_long_formset %}
    <tr>
      <td>
        {% for hidden_field in form.hidden_fields %}
          {{ hidden_field }}
        {% endfor %}
      </td>
      <td>Latitude (decimal): {{ form.latitude }} &#176;</td>
      <td></td>
      <td class="centered">{{ form.DELETE }}</td>
    </tr>
    <tr>
      <td></td>
      <td>Longitude (decimal): {{ form.longitude }} &#176;</td>
      <td></td>
      <td></td>
    </tr>
    {% endfor %}
    {{ experiment_date_formset.management_form }}
    {% for form in experiment_date_formset %}
      <tr>
        <td>
          {% for hidden_field in form.hidden_fields %}
            {{ hidden_field }}
          {% endfor %}
          {% if forloop.first %}
            Date/start date:
          {% else %}
            Date/end date:
          {% endif %}
        </td>
        <td>Year: {{ form.year }} Month: {{ form.month }} Day: {{ form.day }}</td><td class="centered">{{ form.DELETE }}</td>
      </tr>
    {% endfor %}
    <tr>
      <td class="bottom"></td>
      <td class="button bottom"><input type="submit" name="save" value="Save all changes" /></td>
      <td class="button bottom centered"><input type="submit" name="delete" value="Delete selected" /></td>
    </tr>
  </table>
</form>

{% endblock %}
