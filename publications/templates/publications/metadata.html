{% extends 'publications/base.html' %}

{% load metadataset_tags %}

{% block title %}
  Other publication-level metadata | Metadataset | www.metadataset.com
{% endblock %}

{% block css %}
  {% load staticfiles %}
{% endblock %}

{% block content %}

<h1>Other publication-level metadata</h1>
<p>
  <a href="{% url 'publication' subject=subject.slug publication_pk=publication.pk %}">This publication</a>
  > Other publication-level metadata
  <span class="grey">
    > This population
  </span>
</p>

<form method="post" action="">{% csrf_token %}
  <table>
    <tr><th colspan="3">Populations</th></tr>
    <tr><td class="top" colspan="3">When you select and save a population, a link will appear for that population. Click that link to enter metadata for that population.</td></tr>
    <tr>
      <td colspan="2"></td>
      <td class="centered">Select</td>
    </tr>
    {{ publication_population_formset.management_form }}
    {% for form in publication_population_formset %}
      <tr>
        <td>
          {% for hidden_field in form.hidden_fields %}
            {{ hidden_field }}
          {% endfor %}
        </td>
        <td>
          {% if form.instance.population %}
            <a href="{% url 'publication_population' subject=subject.slug publication_pk=publication.pk publication_population_index=forloop.counter0 %}">
              {{ form.instance.population }}
            </a>
            {{ form.population.as_hidden }}
          {% else %}
            {{ form.population }}
          {% endif %}
        </td>
        <td class="centered">{{ form.DELETE }}</td>
      </tr>
    {% endfor %}
    <tr>
      <td class="bottom"></td>
      <td class="button bottom"><input type="submit" name="save" value="Save all changes" /></td>
      <td class="button bottom centered"><input type="submit" name="delete" value="Delete selected" /></td>
    </tr>

    <tr><td class="empty" colspan="3">&nbsp;</td></tr>

    <tr><th colspan="3">Covariates</th></tr>
    <tr>
    </tr>
    <tr>
      <td colspan="2"></td>
      <td class="centered">Select</td>
    </tr>
    {{ publication_country_formset.management_form }}
    {% for form in publication_country_formset %}
      <tr>
        <td>
          {% for hidden_field in form.hidden_fields %}
            {{ hidden_field }}
          {% endfor %}
          {% if forloop.first %}
            {{ form.country.label }}:
          {% endif %}
        </td>
        <td>{{ form.country }}</td>
        <td class="centered">{{ form.DELETE }}</td>
      </tr>
    {% endfor %}
    {{ publication_lat_long_dms_formset.management_form }}
    {% for form in publication_lat_long_dms_formset %}
    <tr>
      <td>
        {% for hidden_field in form.hidden_fields %}
          {{ hidden_field }}
        {% endfor %}
        {% if forloop.first %}
          Coordinates:
        {% endif %}
      </td>
      <td>Latitude (DMS): {{ form.latitude_degrees|add_class:"coordinates" }} &#176; {{ form.latitude_minutes|add_class:"coordinates" }} ' {{ form.latitude_seconds|add_class:"coordinates" }} " {{ form.latitude_direction }}</td>
      <td class="centered">{{ form.DELETE }}</td>
    </tr>
    <tr>
      <td></td>
      <td>Longitude (DMS): {{ form.longitude_degrees|add_class:"coordinates" }} &#176; {{ form.longitude_minutes|add_class:"coordinates" }} ' {{ form.longitude_seconds|add_class:"coordinates" }} " {{ form.longitude_direction }}</td>
      <td></td>
    </tr>
    {% endfor %}
    {{ publication_lat_long_formset.management_form }}
    {% for form in publication_lat_long_formset %}
    <tr>
      <td>
        {% for hidden_field in form.hidden_fields %}
          {{ hidden_field }}
        {% endfor %}
      </td>
      <td>Latitude (decimal): {{ form.latitude }} &#176;</td>
      <td class="centered">{{ form.DELETE }}</td>
    </tr>
    <tr>
      <td></td>
      <td>Longitude (decimal): {{ form.longitude }} &#176;</td>
      <td></td>
    </tr>
    {% endfor %}
    {{ publication_date_formset.management_form }}
    {% for form in publication_date_formset %}
      <tr>
        <td>
          {% for hidden_field in form.hidden_fields %}
            {{ hidden_field }}
          {% endfor %}
          {% if forloop.first %}
            Date/start date:
          {% else %}
            Date/end date:
          {% endif %}
        </td>
        <td>Year: {{ form.year }} Month: {{ form.month }} Day: {{ form.day }}</td>
        <td class="centered">{{ form.DELETE }}</td>
      </tr>
    {% endfor %}
    <tr>
      <td class="bottom"></td>
      <td class="button bottom"><input type="submit" name="save" value="Save all changes" /></td>
      <td class="button bottom centered"><input type="submit" name="delete" value="Delete selected" /></td>
    </tr>

    <tr><td class="empty" colspan="3">&nbsp;</td></tr>

    <tr><th colspan="3">Other covariates</th></tr>
    <tr>
      <td class="top" colspan="3"><a target="_blank" href="{% url 'attributes' subject=subject.slug %}">Add/edit other covariates</a></td>
    </tr>

    {{ EAV_formset.management_form }}
    {% if EAV_formset.forms %}
      {% for form in EAV_formset %}
        <tr>
          <td>
            {% for hidden_field in form.hidden_fields %}
              {{ hidden_field }}
            {% endfor %}
            {% if form.instance.attribute %}
              {{ form.instance.attribute }}:
            {% else %}
              {{ form.attribute.initial }}:
            {% endif %}
            {{ form.attribute.as_hidden }}
            {{ form.publication.as_hidden }}
            {{ form.user.as_hidden }}
          </td>
          <td>
            {% if form.value_as_factor.field.disabled is False %}
              {{ form.value_as_factor }}
            {% endif %}
            {% if form.value_as_number.field.disabled is False %}
              {{ form.value_as_number }} {{ form.unit }}
            {% endif %}
          </td>
          <td class="centered">{{ form.DELETE }}</td>
        </tr>
      {% endfor %}
      <tr>
        <td class="bottom"></td>
        <td class="button bottom"><input type="submit" name="save" value="Save all changes" /></td>
        <td class="button bottom centered"><input type="submit" name="delete" value="Delete selected" /></td>
      </tr>
    {% endif %}

  </table>
</form>

{% endblock %}
