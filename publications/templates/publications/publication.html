{% extends 'publications/base.html' %}

{% load metadataset_tags %}

{% block title %}
  Publication | Metadataset | www.metadataset.com
{% endblock %}

{% block css %}
  {% load staticfiles %}
  <link href="{% static 'css/sidebar.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}

<form method="post" action="">{% csrf_token %}

  <h1>
    Stage 1: Title/Abstract
    {% if is_relevant == 'True' %}
      <span class="grey">(relevant)</span>
    {% elif is_relevant == 'False' %}
      <span class="red">(not relevant)</span>
    {% endif %}
  </h1>
  <p>
    Based on the title/abstract, is this publication relevant to this systematic map? If there is not enough information in the title/abstract, click "Relevant" and then go to <a href="#stage_2">Stage 2: Full Text</a>.
    <!-- A hidden input so that pressing enter saves the form instead of marking the publication as not relevant -->
    <input type="submit" name="save" style="visibility: hidden;" />
  </p>
  <p>
    <input type="submit" name="is_relevant" value="Relevant" />
    <input type="submit" name="is_not_relevant" value="Not relevant" />
    <a class="button" href="{% url 'publication' subject=subject.slug publication_pk=previous_pk %}">Previous publication</a>
    <a class="button" href="{% url 'publication' subject=subject.slug publication_pk=next_pk %}">Next publication</a>
  </p>

  <h1>Title</h1>
  <p>{{ publication.title|default:'[title not available]' }}</p>

  <h1>Abstract</h1>
  <p>{{ publication.abstract|default:'[abstract not available]' }}</p>

  <h1 id="stage_2">
    Stage 2: Full Text
    {% if full_text_is_relevant == 'True' %}
      <span class="grey">(relevant)</span>
    {% elif full_text_is_relevant == 'False' %}
      <span class="red">(not relevant)</span>
    {% endif %}
  </h1>
  <p>
    {% if publication.author_list %}
      {{ publication.author_list|join:", "|default:'[authors not available]' }}
    {% else %}
      {{ publication.authors }}
    {% endif %}
     ({{ publication.year|default:'[year not available]' }}) {{ publication.title|default:'[title not available]' }} <span class="italic">{{ publication.journal|default:'[journal not available]' }}</span> {{ publication.volume|default:'[volume not available]'}}, {{ publication.pages|default:'[pages not available]' }}
  </p>
  <p>
    Search for the full text: <a target="_blank"
      href="http://www.google.com/search?q={{ publication.google_string }}">Google</a>
    {% if publication.doi != '' %}
      | <a target="_blank" href="http://dx.doi.org/{{ publication.doi }}">DOI</a>
    {% endif %}
  </p>
  <p>
    Based on the full text, is this publication relevant to this systematic map? If it is not, you must write the reason here (but if you assessed this publication as not relevant based on the title/abstract, do not write anything here and do not click "not relevant based on full text"). If you cannot find or access the full text, write "Cannot find" or "Cannot access" and then click "Not relevant based on the full text".
  </p>
  <p>
    {{ full_text_assessment_form.note }}
    <input type="submit" name="full_text_is_not_relevant" value="Not relevant based on the full text" />
  </p>

  <h1>Interventions</h1>
  <p>If this publication is relevant, you must select one or more interventions that were tested in this publication.</p>

  <table>
    <tr>
      <td colspan="2">
        {{ experiment_formset.management_form }}
      </td>
      <td class="centered">Select</td>
    </tr>
    {% for form in experiment_formset %}
    <tr>
      <td>
        {% for hidden_field in form.hidden_fields %}
          {{ hidden_field }}
        {% endfor %}
        {% if form.instance.intervention %}
          {{ form.instance.intervention }}{{ form.intervention.as_hidden }}
        {% else %}
          {{ form.intervention|add_class:"select_intervention" }}
        {% endif %}
      </td>
      <td>
        {% if form.instance.intervention %}
          <a href="{% url 'experiment' subject=subject publication_pk=publication.pk experiment_index=forloop.counter0 %}">Populations</a>
        {% endif %}
      </td>
      <td class="centered">{{ form.DELETE }}</td>
    </tr>
    {% endfor %}
    <tr>
      <td class="button bottom"><input type="submit" name="save" value="Save interventions" /></td>
      <td class="bottom"></td>
      <td class="bottom button"><input type="submit" name="delete" value="Delete selected" /></td>
    </tr>
  </table>

</form>

{% endblock %}

{% block sidebar %}
  {% include 'publications/subject_sidebar.html' %}
{% endblock %}
